<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SnaDaily | Lupa Password</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/seasonal-themes.css">
    <script src="js/theme-switcher.js" defer></script>
    <style>
        .auth-card {
            max-width: 500px;
            width: 100%;
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border-bright);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-premium);
            animation: slideUp 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }
    </style>
</head>

<body>
    <div class="ocean-background">
        <div class="bubble x1"></div>
        <div class="bubble x2"></div>
        <div class="bubble x3"></div>
    </div>

    <main class="container flex-center" style="min-height: 100vh;">
        <div class="auth-card" style="padding: 3rem;">
            <div style="text-align: center; margin-bottom: 2.5rem;">
                <div
                    style="width: 60px; height: 60px; background: rgba(0, 212, 255, 0.1); border-radius: 20px; display: grid; place-items: center; margin: 0 auto 1.5rem; border: 1px solid var(--glass-border-bright);">
                    <i class="ri-key-2-line" style="font-size: 2rem; color: var(--primary);"></i>
                </div>
                <h2 style="font-size: 1.75rem; font-weight: 800; margin-bottom: 0.5rem;">Lupa <span
                        class="text-gradient">Password</span></h2>
                <p style="color: var(--text-muted); font-size: 0.9rem;">Masukkan Username atau No. WhatsApp Anda untuk
                    mendapatkan token reset.</p>
            </div>

            <form id="forgotForm">
                <div class="input-group">
                    <label class="input-label">Username / No. WhatsApp</label>
                    <div style="position: relative;">
                        <i class="ri-user-search-line"
                            style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-dim);"></i>
                        <input type="text" id="identifier" class="glass-input" required
                            placeholder="Contoh: bettatumedan" style="padding-left: 3rem;">
                    </div>
                </div>

                <div id="statusMsg"
                    style="margin-bottom: 1.5rem; text-align: center; display: none; padding: 1rem; border-radius: 12px; font-size: 0.9rem;">
                </div>

                <div id="tokenDisplay"
                    style="display: none; background: rgba(0,212,255,0.05); border: 1px dashed var(--primary); padding: 1.5rem; border-radius: 16px; margin-bottom: 2rem; text-align: center;">
                    <p style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.5rem;">SIMPAN TOKEN ANDA:
                    </p>
                    <h3 id="generatedToken"
                        style="font-size: 2rem; font-weight: 900; letter-spacing: 5px; color: var(--primary); margin-bottom: 1rem;">
                        -</h3>
                    <button type="button" onclick="goToReset()" class="btn-primary"
                        style="height: 40px; font-size: 0.8rem; border-radius: 8px;">LANJUT KE RESET PASSWORD <i
                            class="ri-arrow-right-line"></i></button>
                    <p style="font-size: 0.7rem; color: var(--text-muted); margin-top: 1rem;">*Karena beta, token
                        ditampilkan di sini. Nantinya akan dikirim via WA.</p>
                </div>

                <button type="submit" class="btn-primary"
                    style="width: 100%; height: 55px; border-radius: 100px; font-weight: 800;" id="submitBtn">
                    DAPATKAN TOKEN RESET <i class="ri-flashlight-line"></i>
                </button>
            </form>

            <div style="margin-top: 2rem; text-align: center; font-size: 0.85rem;">
                <a href="login.html" style="color: var(--text-muted); text-decoration: none;"> Kembali ke Login</a>
            </div>
        </div>
    </main>

    <script>
        let currentToken = '';

        document.getElementById('forgotForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const identifier = document.getElementById('identifier').value;
            const statusMsg = document.getElementById('statusMsg');

            btn.disabled = true;
            btn.innerHTML = '<i class="ri-loader-4-line ri-spin"></i> MEMPROSES...';

            try {
                const res = await fetch('/api/auth/forgot-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ identifier })
                });
                const data = await res.json();

                if (data.success) {
                    statusMsg.style.display = 'block';
                    statusMsg.style.background = 'rgba(0, 255, 136, 0.1)';
                    statusMsg.style.color = 'var(--secondary)';
                    statusMsg.innerText = data.message;

                    document.getElementById('generatedToken').innerText = data.token;
                    document.getElementById('tokenDisplay').style.display = 'block';
                    btn.style.display = 'none';
                    currentToken = data.token;
                } else {
                    statusMsg.style.display = 'block';
                    statusMsg.style.background = 'rgba(255, 77, 77, 0.1)';
                    statusMsg.style.color = '#ff4d4d';
                    statusMsg.innerText = data.error;
                    btn.disabled = false;
                    btn.innerHTML = 'DAPATKAN TOKEN RESET <i class="ri-flashlight-line"></i>';
                }
            } catch (err) {
                alert('Gagal terhubung ke server.');
                btn.disabled = false;
            }
        });

        function goToReset() {
            window.location.href = `reset-password.html?token=${currentToken}`;
        }
    </script>
</body>

</html>