<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SnaDaily | Atur Ulang Password</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/seasonal-themes.css">
    <script src="js/theme-switcher.js" defer></script>
    <style>
        .auth-card {
            max-width: 500px;
            width: 100%;
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border-bright);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-premium);
            animation: slideUp 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }
    </style>
</head>

<body>
    <div class="ocean-background">
        <div class="bubble x1"></div>
        <div class="bubble x2"></div>
        <div class="bubble x3"></div>
    </div>

    <main class="container flex-center" style="min-height: 100vh;">
        <div class="auth-card" style="padding: 3rem;">
            <div style="text-align: center; margin-bottom: 2.5rem;">
                <div
                    style="width: 60px; height: 60px; background: rgba(0, 255, 136, 0.1); border-radius: 20px; display: grid; place-items: center; margin: 0 auto 1.5rem; border: 1px solid var(--glass-border-bright);">
                    <i class="ri-shield-user-line" style="font-size: 2rem; color: var(--secondary);"></i>
                </div>
                <h2 style="font-size: 1.75rem; font-weight: 800; margin-bottom: 0.5rem;">Atur Ulang <span
                        class="text-gradient">Password</span></h2>
                <p style="color: var(--text-muted); font-size: 0.9rem;">Masukkan token yang Anda dapatkan dan password
                    baru Anda.</p>
            </div>

            <form id="resetForm">
                <div class="input-group">
                    <label class="input-label">Token Reset</label>
                    <div style="position: relative;">
                        <i class="ri-ticket-line"
                            style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-dim);"></i>
                        <input type="text" id="token" class="glass-input" required placeholder="Token 8 Karakter"
                            style="padding-left: 3rem; text-transform: uppercase;">
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">Password Baru</label>
                    <div style="position: relative;">
                        <i class="ri-lock-password-line"
                            style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-dim);"></i>
                        <input type="password" id="password" class="glass-input" required placeholder="••••••••"
                            style="padding-left: 3rem; padding-right: 3rem;">
                        <i class="ri-eye-line" id="toggleEye" onclick="togglePass()"
                            style="position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--text-dim);"></i>
                    </div>
                </div>

                <div id="statusMsg"
                    style="margin-bottom: 1.5rem; text-align: center; display: none; padding: 1rem; border-radius: 12px; font-size: 0.9rem;">
                </div>

                <button type="submit" class="btn-primary"
                    style="width: 100%; height: 55px; border-radius: 100px; font-weight: 800;" id="submitBtn">
                    PERBARUI PASSWORD <i class="ri-checkbox-circle-line"></i>
                </button>
            </form>

            <div style="margin-top: 2rem; text-align: center; font-size: 0.85rem;">
                <a href="login.html" style="color: var(--text-muted); text-decoration: none;"> Batal & Kembali</a>
            </div>
        </div>
    </main>

    <script>
        // Auto-fill token from URL
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('token')) {
            document.getElementById('token').value = urlParams.get('token').toUpperCase();
        }

        function togglePass() {
            const input = document.getElementById('password');
            const eye = document.getElementById('toggleEye');
            if (input.type === 'password') {
                input.type = 'text';
                eye.classList.replace('ri-eye-line', 'ri-eye-off-line');
            } else {
                input.type = 'password';
                eye.classList.replace('ri-eye-off-line', 'ri-eye-line');
            }
        }

        document.getElementById('resetForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const token = document.getElementById('token').value;
            const newPassword = document.getElementById('password').value;
            const statusMsg = document.getElementById('statusMsg');

            btn.disabled = true;
            btn.innerHTML = '<i class="ri-loader-4-line ri-spin"></i> MEMPERBARUI...';

            try {
                const res = await fetch('/api/auth/reset-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token, newPassword })
                });
                const data = await res.json();

                if (data.success) {
                    statusMsg.style.display = 'block';
                    statusMsg.style.background = 'rgba(0, 255, 136, 0.1)';
                    statusMsg.style.color = 'var(--secondary)';
                    statusMsg.innerText = data.message + ' Mengalihkan...';

                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);
                } else {
                    statusMsg.style.display = 'block';
                    statusMsg.style.background = 'rgba(255, 77, 77, 0.1)';
                    statusMsg.style.color = '#ff4d4d';
                    statusMsg.innerText = data.error;
                    btn.disabled = false;
                    btn.innerHTML = 'PERBARUI PASSWORD <i class="ri-checkbox-circle-line"></i>';
                }
            } catch (err) {
                alert('Gagal terhubung ke server.');
                btn.disabled = false;
            }
        });
    </script>
</body>

</html>